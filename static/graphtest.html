<html>
<style>
    svg {
  font: 10px sans-serif;
}

.ref {
  fill: none;
  stroke: steelblue;
  stroke-opacity: .7;
}

.label {
	font-size: 18px;
}

.axis line,
.axis path {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.axis text {
  text-shadow: 0 1px 0 #fff;
  cursor: move;
}
</style>
<body>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script>    

var m = [30, 10, 10, 10],
    w = 960 - m[1] - m[3],
    h = 500 - m[0] - m[2];
    
var eOffset = 50
var mOffset = 330

var svg = d3.select("body").append("svg")
    .attr("width", w + m[1] + m[3])
    .attr("height", h + m[0] + m[2])
  .append("g")
    .attr("transform", "translate(" + m[3] + "," + m[0] + ")");

var eScale = d3.scale.ordinal()
		.domain(tanach_domain([22, 23, 15, 17, 14, 14, 10, 17, 32, 3]))
		.rangePoints([w, 0]);
var eAxis = d3.svg.axis()
		.orient("top")
		.scale(eScale)
		.tickValues(["1:1","2:1","3:1","4:1","5:1","6:1","7:1","8:1","9:1","10:1"]);
var eAxisGroup = svg.append("g")
		.attr("class", "axis")
		.attr("transform","translate(0 " + eOffset + ")")
		.call(eAxis);
svg.append("text")
    .attr("class", "label")
    .attr("x", w/2 - 50)
    .attr("y", 15)
    .text("Megillat Esther");


var mScale = d3.scale.ordinal()
		.domain(bavli_domain("32a"))
		.rangePoints([w,0]);                              
var mAxis = d3.svg.axis()
		.orient("bottom")
		.scale(mScale)
		.tickValues(["2a","2b","5a","10a","15a","20a","25a","30a","32a"]);
var mAxisGroup = svg.append("g")
		.attr("class", "axis")
		.attr("transform","translate(0 " + mOffset + ")")
        .call(mAxis);
svg.append("text")
    .attr("class", "label")
    .attr("x", w/2 - 50)
    .attr("y", 370)
    .text("Talmud Megillah");


var links = [
	{"Megillah": "11a:47", "Esther": "10:1"},
	{"Megillah": "10b:15", "Esther": "1:1"},
	{"Megillah": "11b:12", "Esther": "1:2"},
	{"Megillah": "9a:17", "Esther": "1:20"},
	{"Megillah": "9a:18", "Esther": "1:20"},
	{"Megillah": "12a:15", "Esther": "1:3"},
	{"Megillah": "7a:52", "Esther": "2:15"},
	{"Megillah": "7a:54", "Esther": "2:22"},
	{"Megillah": "10b:65", "Esther": "2:7"},
	{"Megillah": "14b:34", "Esther": "5:1"},
	{"Megillah": "16a:12", "Esther": "6:10"},
	{"Megillah": "16a:15", "Esther": "6:10"},
	{"Megillah": "16a:74", "Esther": "6:13"},
	{"Megillah": "16a:78", "Esther": "6:14"},
	{"Megillah": "16a:5", "Esther": "6:3"},
	{"Megillah": "16a:7", "Esther": "6:4"},
	{"Megillah": "7a:50", "Esther": "6:6"},
	{"Megillah": "16a:60", "Esther": "6:9"},
	{"Megillah": "16b:29", "Esther": "8:16"},
	{"Megillah": "7a:56", "Esther": "9:10"},
	{"Megillah": "5b:29", "Esther": "9:19"},
	{"Megillah": "19a:17", "Esther": "9:19"},
	{"Megillah": "2b:12", "Esther": "9:19"},
	{"Megillah": "2b:33", "Esther": "9:19"},
	{"Megillah": "2b:18", "Esther": "9:21"},
	{"Megillah": "2a:36", "Esther": "9:22"},
	{"Megillah": "2a:34", "Esther": "9:27"},
	{"Megillah": "2a:41", "Esther": "9:27"},
	{"Megillah": "2b:27", "Esther": "9:28"},
	{"Megillah": "7a:72", "Esther": "9:28"},
	{"Megillah": "20a:28", "Esther": "9:28"},
	{"Megillah": "2b:41", "Esther": "9:28"},
	{"Megillah": "19a:6", "Esther": "9:29"},
	{"Megillah": "2a:20", "Esther": "9:31"}
]

svg.append("g").selectAll("line").data(links).enter()
	.append("line")
	.attr("x1", function(d) { return mScale(d.Megillah.split(":")[0]) })
	.attr("y1", mOffset)
	.attr("x2", function(d) { return eScale(d.Esther) })
	.attr("y2", eOffset) 	
	.attr("class","ref")


function bavli_domain(last_page) {
	last_amud = last_page.slice(-1)
	last_daf = last_page.slice(0,-1)
	
	domain = []
	for(i = 2; i <= last_daf - 1; i++)
	{
		domain.push(i + "a")
		domain.push(i + "b") 
	}
	domain.push(last_daf + "a")
	if(last_amud == "b") {
		domain.push(last_daf + "b")
	}
	return domain
}
function tanach_domain(chap_lengths) {
	domain = []
	for (i = 0; i < chap_lengths.length; ++i) {
		for (j = 1; j <= chap_lengths[i]; ++j) {
			domain.push(i+1 + ":" + j)
		}
	}
	return domain
}

function esther_ref_to_index(ref) {
	chap_length = [22, 23, 15, 17, 14, 14, 10, 17, 32, 3]
	pieces = ref.split(":")
	total = 0
	for (i = 0; i < pieces[0] - 1; i++)
	{
		total += chap_length[i]
	} 
	total += parseInt(pieces[1])
	return total
}


function megillah_ref_to_index(ref) {
	chap_length = [0, 0, 65, 61, 66, 60, 31, 70, 55, 57, 78, 75, 78, 72, 48, 42, 37, 49, 47, 84, 73, 48, 86, 88, 69, 79, 84, 59, 80, 94, 105, 68, 56, 54, 86, 80, 56, 42, 42, 27, 54, 67, 70, 58, 50, 40, 44, 71, 58, 61, 46, 56, 74, 84, 77, 75, 82, 66, 86, 27, 40, 68, 50]		
	pieces = ref.split(":")
	
	amud = 0
	if (pieces[0].slice(-1) == "b") { amud = 1 }
	page = pieces[0].slice(0,-1)
	page_index = (page - 1) * 2 + amud

	total = 0
	for (i = 0; i < page_index; i++)
	{
		total += chap_length[i]
	} 
	total += parseInt(pieces[1])
	return total	
}

</script>
</body>
</html>


