{% extends "base.html" %}

{% load sefaria_tags %}
{% load humanize %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
	
	<a href="/sheets" id="textTocLink">&laquo; Source Sheets</div>

	<div id="topicsPage" class="container">

		<div class="row">
			<div class="span12">

				<center>
				{% if group %}
						<img id="partnerLogo" src="/static/partner/{{ group|url_safe }}/logo.png" alt="{{ group }}">
				{% else %}
					<h1>{{ title }}</h1>
				{% endif %}
				</center>

				{% if public %}
					{% include "elements/sheet_tag_list.html" with title="Trending tags" %}

				{% else %}
					{% include "elements/sheet_tag_list.html" with title="Your tags" %}
				{% endif %}

				<ul id="topics">
					{% if group and not in_group and not user.id %}
					<span id="loginMsg">
						If you are a member of the {{ group }} group, <a href="/login?next=/partners/{{ group|url_safe }}">login</a> to view private group sheets.
					</span>
					<div class="clear"></div>
					{% endif %}

					{% include "elements/sheet_table.html" with sheets=topics empty_message="There are no Source Sheets here yet." %}

				</ul>
				<div class="clear"></div>

				<a href="/sheets/new">
					<center><div class="btn btn-large btn-primary">Start a New Sheet</div></center>
				</a>

				<a href="/sheets">&laquo; Browse all Source Sheets</a>

			</div>
		</div>

	</div>

{% endblock %}

{% block js %}
	<script>{% include "js/django-csrf.js" %}</script> 
	<script src="/static/js/jquery.tablesorter.js"></script>
	<script src="/static/js/jquery.tag-it.min.js"></script>
	<script>
		$("img").error(function () { 
		    $(this).hide().after("<h1>"+$(this).attr("alt")+"</h1>");
		});
		$(function() {
			$(".sheetTable").tablesorter();
		});
		$(".editTags").click(function() {
			var id   = parseInt($(this).closest(".sheetRow").attr("data-id"));
			var tags = [];
			$(this).closest(".sheetRow").find(".tag").not(".editTags").each(function() {
				tags.push($(this).text());
			})
			sjs.sheetTagger.init(id, tags);
			sjs.sheetTagger.callback = function() { location.reload(); };
			sjs.sheetTagger.show();
		});

	</script>
{% endblock %}